<?php//$Id: periode.class.php,v 1.6 2008-07-29 14:00:45 jbastide Exp $include ("../dyn/var.inc");require_once ($path_om."formulairedyn.class.php");require_once ($path_om."dbformdyn.class.php");//class periode extends dbForm{    var $table = "periode";    var $clePrimaire = "periode";    var $typeCle = "A";    function periode ($id, $db, $debug)    {        $this -> constructeur ($id, $db, $debug);    } // grade ($id, $db, $debug)    function verifier ()    {        $this -> correct = True;        $imgv="";        $f="&nbsp!&nbsp;&nbsp;&nbsp;&nbsp;";        $imgv="<img src='../img/punaise.png' align='middle'  border='0'>";        if ($this -> valF ['periode'] == ""){            $this -> correct = false;            $this -> msg = $this -> msg .$imgv.$this->lang("periode")."&nbsp;".$this->lang("obligatoire").$f;        }        if ($this -> valF ['libelle'] == ""){            $this -> correct = false;            $this -> msg = $this -> msg .$imgv.$this->lang("libelle")."&nbsp;".$this->lang("obligatoire").$f;        }        if ($this->valF['debut']!=""){           $this->valF['debut'] = $this->heureDB($this->valF['debut']);        }        if ($this->valF['fin']!=""){           $this->valF['fin'] = $this->heureDB($this->valF['fin']);        }    } // verifier ()    function setType (&$form, $maj)     {        if ($maj < 2){            // Ajout            if ($maj == 1){                $form -> setType ('periode', 'hiddenstatic');                // Modification            }        }else{            $form -> setType ('periode', 'hiddenstatic');            // Suppression        }    } // setType (&$form, $maj) function cleSecondaire($id,$db,$val,$debug) {$this->correct=True;$this->rechercheCandidature($id,$db,$debug) ;$this->rechercheAffectation($id,$db,$debug) ;$this->controletraitement($id,$db,$debug) ;}function rechercheCandidature($id,$db,$debug){    $this -> correct = True;    $imgv="";    $f="&nbsp!&nbsp;&nbsp;&nbsp;&nbsp;";    $imgv="<img src='../img/punaise.png' align='middle'  border='0'>";    $sql = "select * from candidature where periode ='".$id."'";    $res = $db->query($sql);    if($debug==1) echo $sql;    if (DB :: isError($res))       die($res->getMessage(). " => Echec  ".$sql);    else{        $nbligne=$res->numrows();        $this->msg = $this->msg.$imgv."&nbsp;".$this->lang("il_y_a")."&nbsp;<font class='parametre'>&nbsp;".$nbligne."&nbsp;</font>&nbsp;".        $this->lang("enregistrement")."&nbsp;".$this->lang("en_lien")."&nbsp;".$this->lang("avec")."&nbsp;".$this->lang("table")." \"candidature\" ".$this->lang("pour")."&nbsp;".$this->lang("la")."&nbsp;".$this->lang("periode")."&nbsp; [".        $id."]".$f."<br>";        if ($nbligne>0)           $this->correct=false;    }}function rechercheAffectation($id,$db,$debug){    $this -> correct = True;    $imgv="";    $f="&nbsp!&nbsp;&nbsp;&nbsp;&nbsp;";    $imgv="<img src='../img/punaise.png' align='middle'  border='0'>";    $sql = "select * from affectation where periode ='".$id."'";    $res = $db->query($sql);    if($debug==1) echo $sql;    if (DB :: isError($res))       die($res->getMessage(). " => Echec  ".$sql);    else{        $nbligne=$res->numrows();        $this->msg = $this->msg.$imgv."&nbsp;".$this->lang("il_y_a")."&nbsp;<font class='parametre'>&nbsp;".$nbligne."&nbsp;</font>&nbsp;".        $this->lang("enregistrement")."&nbsp;".$this->lang("en_lien")."&nbsp;".$this->lang("avec")."&nbsp;".$this->lang("table")." \"affectation\" ".$this->lang("pour")."&nbsp;".$this->lang("la")."&nbsp;".$this->lang("periode")."&nbsp; [".        $id."]".$f."<br>";        if ($nbligne>0)           $this->correct=false;    }}function heureDB($val) {$this -> correct = True;$imgv="";$f="&nbsp!&nbsp;&nbsp;&nbsp;&nbsp;";$imgv="<img src='../img/punaise.png' align='middle'  border='0'>";// =====================================================================// controle du champs heure saisi 00 ou 00:00 ou 00:00:00// =====================================================================// pb saisie H et h **************$val = str_replace("H",":",$val);$val = str_replace("h",":",$val);// ================================$heure = explode(":", $val);for($i=0;$i<sizeof($heure);$i++){    if(is_numeric($heure[$i])){        $num=1;    }else{        $num=0;        $i=sizeof($heure);    }}   // sur 2   if ((sizeof($heure) >= 1 or sizeof($heure) <= 2 ) and $num==1) {      If (sizeof($heure) ==1 and $heure[0]>=0 and $heure[0] <= 23)         return $heure[0].":00";      If (sizeof($heure) ==2 and $heure[0]>=0 and $heure[0] <= 23 and $heure[1]>=0 and $heure[1] <= 59)            return $heure[0].":".$heure[1];    //  If (sizeof($heure) ==3 and $heure[0]>=0 and $heure[0] <= 23 and $heure[1]>=0 and $heure[1] <= 59 and $heure[2]>=0 and $heure[2] <= 59)    //        return $heure[0].":".$heure[1].":".$heure[2];   }       $this->msg= $this->msg.$imgv."&nbsp;".$this->lang("l")."&nbsp;".$this->lang("heure")."&nbsp;".$val."&nbsp;".$this->lang("n_est_pas_une_heure").$f;       $this->correct=false;}function controletraitement($id,&$db,$debug){$this -> correct = True;$imgv="";$f="&nbsp!&nbsp;&nbsp;&nbsp;&nbsp;";$imgv="<img src='../img/punaise.png' align='middle'  border='0'>";if($id == 'matin' or $id == 'apres-midi' or $id== 'journee'){ $this->msg = $this->msg.$imgv."&nbsp;".$this->lang("vous_ne_pouvez_pas_supprimer")."&nbsp;".$this->lang("pour")."&nbsp;".$this->lang("le")."&nbsp;".$this->lang("poste")." [".        $id."] ("."&nbsp;".$this->lang("poste")."&nbsp;".$this->lang("utilise")."&nbsp;".$this->lang("dans")."&nbsp;".$this->lang("les")."&nbsp;".$this->lang("traitement").$this->lang("pluriel")."&nbsp)".$f;        $this->correct=false;}}}?>