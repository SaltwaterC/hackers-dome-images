<?php//$Id: scrutin.class.php,v 1.8 2008-07-29 14:00:45 jbastide Exp $include ("../dyn/var.inc");require_once ($path_om."formulairedyn.class.php");require_once ($path_om."dbformdyn.class.php");class scrutin extends dbForm{    var $table = "scrutin";    var $clePrimaire = "scrutin";    var $typeCle = "A";    function scrutin ($id, $db, $debug)    {        $this -> constructeur ($id, $db, $debug);    } // param_scrutin ($id, $db, $debug)    function verifier ()    {        $this -> correct = True;        $imgv="";        $f="&nbsp!&nbsp;&nbsp;&nbsp;&nbsp;";        $imgv="<img src='../img/punaise.png' align='middle'  border='0'>";        if ($this -> valF ['scrutin'] == "")        {            $this -> correct = false;            $this -> msg = $this -> msg .$imgv.$this->lang("code")."&nbsp;".$this->lang("scrutin")."&nbsp".$this->lang("obligatoire").$f;        }else{            $pos = strpos($this -> valF ['scrutin'], ' ');            if ($pos === false) {             //Le caractere blanc  n'a pas été trouvée dans la chaîne scrutin            }else{               $this -> correct = false;               $this -> msg = $this -> msg .$imgv.$this->lang("code")."&nbsp;".$this->lang("scrutin")."&nbsp:&nbsp;".$this->lang("NE_DOIT_PAS_COMPORTER_DE_CARACTERE(S)_BLANC").$f;            }        }        if ($this -> valF ['canton'] == "")        {            $this -> correct = false;            $this -> msg = $this -> msg .$imgv.$this->lang("canton")."&nbsp".$this->lang("obligatoire").$f;        }        if ($this -> valF ['libelle'] == "")        {            $this -> correct = false;            $this -> msg = $this -> msg .$imgv.$this->lang("libelle")."&nbsp;".$this->lang("scrutin")."&nbsp".$this->lang("obligatoire").$f;        }        if ($this->valF['date_scrutin']==""){            $this -> correct = false;            $this -> msg = $this -> msg .$imgv.$this->lang("date")."&nbsp;".$this->lang("scrutin")."&nbsp".$this->lang("obligatoire").$f;        }else{           $this->valF['date_scrutin'] = $this->dateDB($this->valF['date_scrutin']);        }    } // verifier ()    function setType (&$form, $maj)     {        if ($maj < 2)        {            // Ajout            $form -> setType ('canton', 'select');            $form -> setType ('tour', 'select');            $form -> setType ('date_scrutin', 'date');            $form -> setType ('solde', 'checkbox');            if ($maj == 1)            {                // Modification                 $form -> setType ('scrutin', 'hiddenstatic');            }        }        else        {             $form -> setType ('scrutin', 'hiddenstatic');            // Suppression        }    } // setType (&$form, $maj)     function setSelect(&$form,$maj,$db,$DEBUG)    {        include ("../dyn/connexion.php");        include ("../sql/".$dsn['phptype']."/".$this -> table.".form.inc");                // Liste de choix : canton        $res = $db->query($sql_canton);        if (DB :: isError($res))            die($res->getMessage().$sql_canton);        else        {            if ($DEBUG == 1)                echo " la requete ".$sql_canton." est exécutée<br>";            $contenu [0][0] = "";            $contenu [1][0] = $this->lang("choisir")."&nbsp;".$this->lang("un")."&nbsp;".$this->lang("canton");            $k=1;            while ($row=& $res->fetchRow())            {                    $contenu[0][$k]=$row[0];                    $contenu[1][$k]=$row[1];                    $k++;            }            $form->setSelect('canton',$contenu);        }                // tour        $contenu=array();        $contenu[0]=array('1','2');        $contenu[1]=array($this->lang("1er")."&nbsp;".$this->lang("tour"),$this->lang("2eme")."&nbsp;".$this->lang("tour"));        $form->setSelect("tour",$contenu);    } // setSelect(&$form,$maj,$db,$DEBUG)    function setTaille(&$form,$maj)    {        $form->setTaille('date_scrutin', 12);        $form->setTaille('convocation_agent', 80);        $form->setTaille('convocation_president', 80);    }function cleSecondaire($id,$db,$val,$debug) {$this->rechercheAffectation($id,$db,$debug) ;$this->rechercheCandidature($id,$db,$debug) ;}function rechercheAffectation($id,$db,$debug){    $this -> correct = True;    $imgv="";    $f="&nbsp!&nbsp;&nbsp;&nbsp;&nbsp;";    $imgv="<img src='../img/punaise.png' align='middle'  border='0'>";    $sql = "select * from affectation where scrutin ='".$id."'";    $res = $db->query($sql);    if($debug==1) echo $sql;    if (DB :: isError($res))       die($res->getMessage(). " => Echec  ".$sql);    else{        $nbligne=$res->numrows();        $this->msg = $this->msg.$imgv."&nbsp;".$this->lang("il_y_a")."&nbsp;<font class='parametre'>&nbsp;".$nbligne."&nbsp;</font>&nbsp;".        $this->lang("enregistrement")."&nbsp;".$this->lang("en_lien")."&nbsp;".$this->lang("avec")."&nbsp;".$this->lang("table")." \"affectation\" ".$this->lang("pour")."&nbsp;".$this->lang("le")."&nbsp;".$this->lang("scrutin")."&nbsp; [".        $id."]".$f."<br>";        if ($nbligne>0)           $this->correct=false;    }}function rechercheCandidature($id,$db,$debug){    $this -> correct = True;    $imgv="";    $f="&nbsp!&nbsp;&nbsp;&nbsp;&nbsp;";    $imgv="<img src='../img/punaise.png' align='middle'  border='0'>";    $sql = "select * from candidature where scrutin ='".$id."'";    $res = $db->query($sql);    if($debug==1) echo $sql;    if (DB :: isError($res))       die($res->getMessage(). " => Echec  ".$sql);    else{        $nbligne=$res->numrows();        $this->msg = $this->msg.$imgv."&nbsp;".$this->lang("il_y_a")."&nbsp;<font class='parametre'>&nbsp;".$nbligne."&nbsp;</font>&nbsp;".        $this->lang("enregistrement")."&nbsp;".$this->lang("en_lien")."&nbsp;".$this->lang("avec")."&nbsp;".$this->lang("table")." \"candidature\" ".$this->lang("pour")."&nbsp;".$this->lang("le")."&nbsp;".$this->lang("scrutin")."&nbsp; [".        $id."]".$f."<br>";        if ($nbligne>0)           $this->correct=false;    }}  function setOnchange(&$form,$maj){$form->setOnchange("scrutin","suppesp(this)");?><script language="javascript">function suppesp(champ){   p=/ {1,}/g   champ.value = champ.value.replace(p, "");}</script><?php}}?>